<!DOCTYPE html>
<!--
 Forty by HTML5 UP
 html5up.net | @ajlkn
 Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
  {% include head.html %}
  <body>
    {% include header.html %}
    <!-- Main -->
    <div id="main" class="alt">
      <!-- One -->
      <section id="one">
        <div class="inner">
          <header class="major">
            <h1>{{ page.title }}</h1>
          </header>
          <!-- Tag Filter -->
          <div class="tags-container">
            <div class="tags-row">
              {% for tag in page.tag %}
              {% if tag != "" %}
              <button class="tag-button" data-tag="{{ tag }}">{{ tag }}</button>
              {% endif %}
              {% endfor %}
              <button class="tag-button active" data-tag="all">All</button>
            </div>
          </div>
          <!-- Post Lists -->
          <div class="posts-grid">
            {% for post in site.posts %}
            <a href="{{ post.url | relative_url }}" class="post-box"
              data-tags="{% for tag in post.tag %}{{ tag }} {% endfor %}">
              <div class="post-content">
                <h2>{{ post.title }}</h2>
                <p>{{ post.description }}</p>
              </div>
              <div class="post-tags">
                {% for tag in post.tags %}
                <span class="post-tag">{{ tag }}</span>
                {% endfor %}
              </div>
            </a>
            {% endfor %}
          </div>
        </div>
      </section>
    </div>
    {% include footer.html %}

    <!-- Tag Filtering JavaScript -->
    <script>
document.addEventListener('DOMContentLoaded', function() {
  const tagButtons = document.querySelectorAll('.tag-button');
  const postBoxes = document.querySelectorAll('.post-box');
  const activeTags = new Set(['all']);
  
  // Initial state - all posts visible
  updateVisibility();
  
  // Add click event to all tag buttons
  tagButtons.forEach(button => {
    button.addEventListener('click', function() {
      const tag = this.getAttribute('data-tag');
      
      // Toggle active class
      this.classList.toggle('active');
      
      // Handle the "All" tag specially
      if (tag === 'all') {
        if (this.classList.contains('active')) {
          // If "All" is activated, deactivate all other tags
          tagButtons.forEach(btn => {
            if (btn.getAttribute('data-tag') !== 'all') {
              btn.classList.remove('active');
            }
          });
          activeTags.clear();
          activeTags.add('all');
        } else {
          // If "All" is deactivated and no other tags are active, reactivate it
          if (activeTags.size === 0 || (activeTags.size === 1 && activeTags.has('all'))) {
            this.classList.add('active');
            activeTags.add('all');
          }
        }
      } else {
        // When clicking a specific tag
        if (this.classList.contains('active')) {
          // Add tag to active set
          activeTags.add(tag);
          // Deactivate "All" button if it was active
          const allButton = document.querySelector('.tag-button[data-tag="all"]');
          if (allButton.classList.contains('active')) {
            allButton.classList.remove('active');
            activeTags.delete('all');
          }
        } else {
          // Remove tag from active set
          activeTags.delete(tag);
          // If no tags are active, activate "All" button
          if (activeTags.size === 0) {
            const allButton = document.querySelector('.tag-button[data-tag="all"]');
            allButton.classList.add('active');
            activeTags.add('all');
          }
        }
      }
      
      updateVisibility();
    });
  });
  
  function updateVisibility() {
    // Show all posts if "All" is active
    if (activeTags.has('all')) {
      postBoxes.forEach(box => {
        box.style.display = 'block';
      });
      return;
    }
    
    // Otherwise filter posts by active tags
    postBoxes.forEach(box => {
      const postTags = box.getAttribute('data-tags').trim().split(' ');
      
      // Show post only if it contains ALL selected tags
      const shouldShow = Array.from(activeTags).every(tag => postTags.includes(tag));
      box.style.display = shouldShow ? 'block' : 'none';
    });
  }
  
  // Highlight matching tags in post boxes
  function highlightMatchingTags() {
    if (activeTags.has('all')) {
      // No highlighting needed when all posts are shown
      document.querySelectorAll('.post-tag').forEach(tag => {
        tag.classList.remove('highlight');
      });
      return;
    }
    
    document.querySelectorAll('.post-box').forEach(box => {
      const postTagElements = box.querySelectorAll('.post-tag');
      postTagElements.forEach(tagEl => {
        if (activeTags.has(tagEl.textContent)) {
          tagEl.classList.add('highlight');
        } else {
          tagEl.classList.remove('highlight');
        }
      });
    });
  }
  
  // Update tag highlighting when visibility changes
  const originalUpdateVisibility = updateVisibility;
  updateVisibility = function() {
    originalUpdateVisibility();
    highlightMatchingTags();
  };
  
  // Initial highlighting
  highlightMatchingTags();
});
</script>
  </body>
</html>